<div class="apple-page-wrapper">
    
    <div class="form-container">
        <header class="form-header">
            <a routerLink="/dashboard/catalogs" class="back-btn" title="Geri Dön">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <div class="header-text">
                <h1>Yeni Katalog Ekle</h1>
                <p>Kataloğun temel bilgilerini ve PDF dosyasını yükleyin.</p>
            </div>
        </header>

        <div class="form-card">
            
            @if (targetFolderId) {
                <div class="folder-context-info">
                    <span class="material-symbols-outlined info-icon">folder_open</span>
                    <div class="info-content">
                        <strong>Hedef Klasör Seçili</strong>
                        <p>Bu katalog oluşturulduktan sonra otomatik olarak seçtiğiniz klasörün içine taşınacaktır.</p>
                    </div>
                </div>
            }

            <form (ngSubmit)="onSubmit()">
                
                <div class="form-group">
                    <label class="form-label">Katalog Adı <span class="required">*</span></label>
                    <input [(ngModel)]="model.name" name="name" type="text" 
                           placeholder="Örn: Ford Transit 2024 Motor" 
                           class="form-input" required autofocus>
                </div>

                <div class="form-group">
                    <label class="form-label">Açıklama</label>
                    <textarea [(ngModel)]="model.description" name="description" rows="3" 
                              placeholder="Katalog hakkında kısa bilgi, model yılı vb..." 
                              class="form-textarea"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Kapak Görseli <span class="optional">(İsteğe Bağlı)</span></label>
                    
                    @if (!model.imageUrl) {
                        <label class="upload-box image-upload" [class.disabled]="isUploadingImage">
                            <input type="file" (change)="onImageSelected($event)" accept="image/*" hidden [disabled]="isUploadingImage">
                            
                            @if (!isUploadingImage) {
                                <div class="upload-content">
                                    <span class="material-symbols-outlined icon">image</span>
                                    <span class="upload-text">Görsel Seç veya Sürükle</span>
                                    <span class="upload-hint">JPG, PNG (Max 5MB)</span>
                                </div>
                            } @else {
                                <div class="upload-loading">
                                    <span class="material-symbols-outlined spin">sync</span>
                                    <span>Yükleniyor...</span>
                                </div>
                            }
                        </label>
                    } @else {
                        <div class="image-preview">
                            <img [src]="model.imageUrl" alt="Preview">
                            <button (click)="model.imageUrl = ''" type="button" class="remove-btn" title="Görseli Kaldır">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    }
                </div>

                <div class="form-group">
                    <label class="form-label">Katalog PDF <span class="required">*</span></label>
                    
                    @if (!model.pdfUrl) {
                        <label class="upload-box pdf-upload" [class.disabled]="isUploadingPdf">
                            <input type="file" (change)="onPdfSelected($event)" accept="application/pdf" hidden [disabled]="isUploadingPdf">
                            
                            @if (!isUploadingPdf) {
                                <div class="upload-content">
                                    <span class="material-symbols-outlined icon">picture_as_pdf</span>
                                    <span class="upload-text">PDF Dosyasını Seçin</span>
                                    <span class="upload-hint">Maksimum 50MB</span>
                                </div>
                            } @else {
                                <div class="upload-loading">
                                    <span class="material-symbols-outlined spin">sync</span>
                                    <span>PDF Yükleniyor...</span>
                                </div>
                            }
                        </label>
                    } @else {
                        <div class="file-preview pdf-file">
                            <div class="file-info">
                                <div class="file-icon-box">
                                    <span class="material-symbols-outlined">description</span>
                                </div>
                                <div class="file-details">
                                    <span class="file-name">{{ getFileName(model.pdfUrl) }}</span>
                                    <span class="file-status">
                                        <span class="material-symbols-outlined check-icon">check_circle</span>
                                        Yüklendi ve hazır
                                    </span>
                                </div>
                            </div>
                            <button (click)="model.pdfUrl = ''" type="button" class="icon-btn delete" title="Sil">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    }
                </div>

                <div class="form-actions">
                    <button type="button" routerLink="/dashboard/catalogs" class="btn-cancel">
                        İptal
                    </button>
                    
                    <button type="submit" 
                            [disabled]="isLoading || isUploadingImage || isUploadingPdf || !model.name || !model.pdfUrl" 
                            class="btn-submit">
                        @if (isLoading) {
                            <span class="material-symbols-outlined spin">sync</span>
                            Kaydediliyor...
                        } @else {
                            <span class="material-symbols-outlined">save</span>
                            Kataloğu Oluştur
                        }
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>